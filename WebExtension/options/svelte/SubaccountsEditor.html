<div id="subaccountsEditor" ref:root>
	{#if busy}
		<div class="editorShield"></div>
	{/if}
	{#if $prefsLoaded}
		{#each Object.entries($subaccounts) as [owner, owned] (owner)}
			<SubaccountOwner {owner} {owned} on:add="editorEvent('add', this)"
				on:remove="editorEvent('remove', event)" on:changeOwner="editorEvent('changeOwner', this)"/>
		{:else}
			<div id="subaccountsEditorExplainer">{$l10n("subaccountsEditorExplain")}</div>
		{/each}
		<div class="newOwner">
			{#if !showNewOwnerForm}
				<button type="button"
					on:click="set({showNewOwnerForm: true, newOwner: '', firstSubaccount: ''})">
					{$l10n("subaccountsEditorAddMainAccount")}
				</button>
			{:else}
				<form class="subaccountOwner newOwnerForm" on:submit="editorEvent('newOwner')">
					<div class="editorLine ownerLine">
						<span class="accountName">
							<input bind:value="newOwner" required autofocus
								placeholder="{$l10n('subaccountsEditorOwnerPlaceholder')}">
						</span>
						<button type="button" tabindex="-1" class="cancelOwner"
							on:click="set({showNewOwnerForm: false})">
							{$l10n("subaccountsEditorCancelOwner")}
						</button>
					</div>
					<div class="editorLine firstSubaccount">
						<input bind:value="firstSubaccount" required
							placeholder="{$l10n('subaccountsEditorAddPlaceholder')}">
						<button type="submit">{$l10n("subaccountsAddConfirm")}</button>
					</div>
				</form>
			{/if}
		</div>
	{/if}
</div>
{#if warnings.length}
	<div class="subaccountsMessage warning">
		{#each warnings as {msg, parts}}
			<p>{$l10n("subaccountsWarning" + msg, parts)}</p>
		{/each}
	</div>
{/if}
{#if error}
	<div class="subaccountsMessage error">{$l10n("subaccountsError" + error.msg, error.parts)}</div>
{/if}
<script>
import SubaccountOwner from "./SubaccountOwner.html";
export default {
	components: { SubaccountOwner },
	data() { return {
		warnings: [],
	}; },
	methods: {
		editorEvent(eventName, details) {
			if (this.get().busy) { return; }
			this.set({warnings: [], error: null});
			this.fire(eventName, details);
		},
		addWarning(warning) {
			var {warnings} = this.get();
			warnings.push(warning);
			this.set({warnings});
		},
	},
	oncreate() {
		this.refs.root.addEventListener("submit", (event) => {
			event.preventDefault();
		});
	},
};
</script>