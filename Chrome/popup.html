<!--
	This file is part of Deviant Love.
	Copyright 2010 Pikadude No. 1
	Check core.js for the complete legal stuff.
-->
<!doctype html>
<html>
<link rel="stylesheet" href="core/builtinskin.css" type="text/css">
<style type="text/css">
body > div { height: 100%; }
</style>
<script type="text/javascript" src="core/jquery.js"></script>
<script type="text/javascript" src="core/core.js"></script>
<script type="text/javascript">
var displayType = "popup";
$(document).ready( function() {
	$("body").css({
		"-webkit-box-sizing": "border-box",
		"height": $(window).height(),
		"margin": 0
	});
	chrome.extension.sendRequest({action: "popupSetup"},
		function(initData) {
			setL10n(initData.l10n);
			fulfillPurpose(initData.pageType);
			chrome.extension.connect({name: "fetchFeedData"}).onMessage.addListener(collectResearch);
		}
	)
} );
function collectResearch(thing) {switch (thing.whatsUp) {
	case "faves": collectData(thing.data); break;
	case "scanError": scanError(); break;
	case "watched": collectWatchlist(thing.data); break;
	case "watchError": watchError(); break;
}}
chrome.extension.onRequest.addListener(function(thing, buddy, callback) {switch (thing.action) {
	case "scanningComplete":
		// This message can't be received through the port because manager.js needs to receive it, too
		scanDone_startFun(thing.tip);
	break;
	case "changeTip":
		tipOfTheMoment(thing.tip);
		callback();
	break;
}});
function scanRetry() {
	chrome.extension.sendRequest({action: "scanRetry"});
}
$(document).delegate("a", "click", function(event) {
	if (event.button == 0) { window.open(this.href); }
	event.preventDefault();
} );
$(window).bind("resize", function() {
	$("body").height($(window).height());
} );
</script>
<body class="popup"></body>
</html>